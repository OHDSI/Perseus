<div class="app-mapping">
  <section>
    <main #maincanvas class="main">
      <div class="area-source">
        <mat-tab-group (selectedIndexChange)="onTabIndexChanged($event, source, 'source')" mat-align-tabs="start">
          <mat-tab
            [label]="table.name"
            *ngFor="let table of source; trackBy: trackByFn"
          >
            <app-panel
              #sourcePanel
              *ngIf="table.visible"
              [tabIndex]="sourceTabIndex"
              [table]="table"
              [tables]="source"
              [oppositeTableId]="target[targetTabIndex].id"
              (open)="onPanelOpen(table)"
              (close)="onPanelClose(table)"
              (initialized)="onPanelInit(table)"
            ></app-panel>
          </mat-tab>
        </mat-tab-group>
      </div>
      <!--Bridge-->
      <div class="hint">
        <div class="patch-top"></div>
        <svg class="canvas" #arrowsarea>
          <defs>
            <marker
              id="marker-start"
              viewBox="0 0 20 20"
              refX="4"
              refY="8"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <rect x="0" y="0" rx="5" width="20" height="16" fill="#BDBDBD" pointer-events="visiblePoint"/>
              <line x1="8" y1="4" x2="16" y2="12" style="stroke:rgb(255, 255, 255); stroke-width: 1.5" />
              <line x1="16" y1="4" x2="8" y2="12" style="stroke:rgb(255, 255, 255); stroke-width: 1.5" />
            </marker>
            <marker
              id="marker-start-active"
              viewBox="0 0 20 20"
              refX="4"
              refY="8"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <rect x="0" y="0" rx="5" width="20" height="16" fill="#066BBB"/>
              <line x1="8" y1="4" x2="16" y2="12" style="stroke:rgb(255, 255, 255); stroke-width: 1.5" />
              <line x1="16" y1="4" x2="8" y2="12" style="stroke:rgb(255, 255, 255); stroke-width: 1.5" />
            </marker>

            <marker
              id="marker-end"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#BDBDBD" />
            </marker>
            <marker
              id="marker-end-T"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#BDBDBD" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11;">T</text>
            </marker>
            <marker
              id="marker-end-L"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#BDBDBD" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11;">L</text>
            </marker>
            <marker id="marker-end-M"
                    viewBox="0 0 20 20"
                    refX="8"
                    refY="10"
                    markerWidth="20"
                    markerHeight="20"
                    markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#BDBDBD" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11;">M</text>
            </marker>
            <marker
              id="marker-end-active"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#066BBB" />
            </marker>
            <marker
              id="marker-end-active-T"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#066BBB" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11;">T</text>
            </marker>
            <marker
              id="marker-end-active-L"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#066BBB" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11;">L</text>
            </marker>
            <marker
              id="marker-end-active-M"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#066BBB" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11;">M</text>
            </marker>
          </defs>
        </svg>
        <!-- <div class="patch-bottom"></div> -->
      </div>
      <!--End-of-the-Bridge-->
      <div class="area-target">
        <mat-tab-group selectedIndex="{{targetTabIndex}}" (selectedIndexChange)="onTabIndexChanged($event, target, 'target')">
          <mat-tab
            [label]="table.name"
            *ngFor="let table of target; trackBy: trackByFn"
            [disabled]="isDisabled(table.name)"
          >
            <app-panel
              #targetPanel
              *ngIf="table.visible"
              [tabIndex]="targetTabIndex"
              [table]="table"
              [tables]="target"
              [oppositeTableId]="source[sourceTabIndex].id"
              [filteredFields]="getFilteredFields()"
              [mappingConfig]="mappingConfig"
              (open)="onPanelOpen(table)"
              (close)="onPanelClose(table)"
              (initialized)="onPanelInit(table)"
            ></app-panel>
          </mat-tab>
        </mat-tab-group>
        <mat-icon matTooltip="Filters applied"
                  matTooltipPosition="above"
                  [matTooltipDisabled]="isTooltipDisabled()"
                  class="targetFilter"
                  (click)="openFilter($event.target)">sort
        </mat-icon>
      </div>
    </main>
    <footer>
      <button
        mat-flat-button
        color="accent"
        class="mapping-page-button"
        matTooltip="Download ziped mappings"
        aria-label="Download mappings xmls"
        [disabled]="isFooterButtonDisabled()"
        (click)="generateMappingJson()"
      >Generate & Save
      </button>
      <button
        mat-flat-button
        color="accent"
        class="mapping-page-button"
        matTooltip="Preview mappings"
        aria-label="Preview mapping xmls"
        [disabled]="isFooterButtonDisabled() || isSimilarTabs()"
        (click)="previewMapping()"
      >Preview
      </button>
      <button
        mat-flat-button
        color="accent"
        class="mapping-page-button"
        [disabled]="isFooterButtonDisabled()"
        (click)="generateReport()"
      >Report
      </button>
      <button
        mat-flat-button
        class="mapping-page-button delete-links"
        [disabled]="isFooterButtonDisabled()"
        (click)="deleteLinks()"
      >Delete Links
      </button>
    </footer>
  </section>
</div>
