<div class="app-mapping">
  <section>
    <main #maincanvas [style.height]="mainHeight" class="main">
      <div class="area-source">
        <mat-tab-group selectedIndex="{{sourceTabIndex}}"
                       (selectedIndexChange)="onTabIndexChanged($event, 'source')"
                       mat-align-tabs="start">
          <mat-tab [label]="'similar'"
                   *ngIf="similarSourceTable">
            <app-panel #sourcePanelSimilar
                       *ngIf="similarSourceTable.visible"
                       [tabIndex]="sourceTabIndex"
                       [table]="similarSourceTable"
                       [tables]="source"
                       [oppositeTableId]="currentTargetTable.id"
                       (open)="onPanelOpen()"
                       (close)="onPanelClose()"
                       (initialized)="onPanelInit(similarSourceTable)"></app-panel>
          </mat-tab>
          <mat-tab>
            <ng-template mat-tab-label>
              <div class="drop-down-label"
                   (wheel) = "onWheel($event, 'source')"
                   (click)="openTablesDropdown($event.target, 'source')">
                <div>{{selectedSourceTable.name}}</div>
                <mat-icon *ngIf="this.sourceTablesWithoutSimilar.length > 1">arrow_drop_down</mat-icon>
              </div>
            </ng-template>
            <app-panel #sourcePanel
                       *ngIf="selectedSourceTable.visible"
                       [tabIndex]="sourceTabIndex"
                       [table]="selectedSourceTable"
                       [tables]="source"
                       [oppositeTableId]="currentTargetTable.id"
                       (open)="onPanelOpen()"
                       (close)="onPanelClose()"
                       (initialized)="onPanelInit(selectedSourceTable)"></app-panel>
          </mat-tab>
        </mat-tab-group>
      </div>
      <!--Bridge-->
      <div class="hint">
        <div class="patch-top"></div>
        <svg class="canvas" #arrowsarea>
          <defs>
            <marker
              id="marker-start"
              viewBox="0 0 20 20"
              refX="4"
              refY="8"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <rect x="0" y="0" rx="5" width="20" height="16" fill="#BDBDBD" pointer-events="visiblePoint"/>
              <line x1="8" y1="4" x2="16" y2="12" style="stroke:rgb(255, 255, 255); stroke-width: 1.5" />
              <line x1="16" y1="4" x2="8" y2="12" style="stroke:rgb(255, 255, 255); stroke-width: 1.5" />
            </marker>
            <marker
              id="marker-start-active"
              viewBox="0 0 20 20"
              refX="4"
              refY="8"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <rect x="0" y="0" rx="5" width="20" height="16" fill="#066BBB"/>
              <line x1="8" y1="4" x2="16" y2="12" style="stroke:rgb(255, 255, 255); stroke-width: 1.5" />
              <line x1="16" y1="4" x2="8" y2="12" style="stroke:rgb(255, 255, 255); stroke-width: 1.5" />
            </marker>

            <marker
              id="marker-end"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#BDBDBD" />
            </marker>
            <marker
              id="marker-end-T"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#BDBDBD" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11px;">T</text>
            </marker>
            <marker
              id="marker-end-L"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#BDBDBD" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11px;">L</text>
            </marker>
            <marker id="marker-end-M"
                    viewBox="0 0 20 20"
                    refX="8"
                    refY="10"
                    markerWidth="20"
                    markerHeight="20"
                    markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#BDBDBD" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11px;">M</text>
            </marker>
            <marker
              id="marker-end-active"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#066BBB" />
            </marker>
            <marker
              id="marker-end-active-T"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#066BBB" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11px;">T</text>
            </marker>
            <marker
              id="marker-end-active-L"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#066BBB" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11px;">L</text>
            </marker>
            <marker
              id="marker-end-active-M"
              viewBox="0 0 20 20"
              refX="8"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#066BBB" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11px;">M</text>
            </marker>
          </defs>
        </svg>
        <!-- <div class="patch-bottom"></div> -->
      </div>
      <!--End-of-the-Bridge-->
      <div class="area-target">
        <mat-tab-group selectedIndex="{{targetTabIndex}}"
                       (selectedIndexChange)="onTabIndexChanged($event, 'target')">
          <mat-tab [label]="'similar'"
                   *ngIf="similarTargetTable">
            <app-panel #targetPanelSimilar
                       *ngIf="similarTargetTable.visible"
                       [tabIndex]="targetTabIndex"
                       [table]="similarTargetTable"
                       [tables]="target"
                       [oppositeTableId]="currentSourceTable.id"
                       [filteredFields]="getFilteredFields()"
                       [mappingConfig]="mappingConfig"
                       (open)="onPanelOpen()"
                       (close)="onPanelClose()"
                       (initialized)="onPanelInit(similarTargetTable)"></app-panel>
          </mat-tab>
          <mat-tab>
            <ng-template mat-tab-label>
              <div class="drop-down-label"
                   (wheel)="onWheel($event, 'target')"
                   (click)="openTablesDropdown($event.target, 'target')">
                <div>{{selectedTargetTable.name}}</div>
                <mat-icon *ngIf="getEnabledTargetTables().length > 1">arrow_drop_down</mat-icon>
              </div>
            </ng-template>
            <app-panel #targetPanel
                       *ngIf="selectedTargetTable.visible"
                       [tabIndex]="targetTabIndex"
                       [table]="selectedTargetTable"
                       [tables]="target"
                       [oppositeTableId]="currentSourceTable.id"
                       [filteredFields]="getFilteredFields()"
                       [mappingConfig]="mappingConfig"
                       (open)="onPanelOpen()"
                       (close)="onPanelClose()"
                       (initialized)="onPanelInit(selectedTargetTable)"
                       (changeClone)="changeTargetClone($event)"></app-panel>
          </mat-tab>
        </mat-tab-group>
        <mat-icon matTooltip="Filters applied"
                  matTooltipPosition="above"
                  [matTooltipDisabled]="isTooltipDisabled()"
                  class="targetFilter"
                  (click)="openFilter($event.target)">sort
        </mat-icon>
      </div>
    </main>

    <footer class="mapping-footer">
      <div class="mapping-footer__block vocabulary">
        <button class="mapping-footer__vocabulary" (click)="showVocabulary()">
          <svg width="23" height="16" viewBox="0 0 23 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18.4351 10.0629H17.7124L17.4563 9.81589C18.3528 8.77301 18.8925 7.4191 18.8925 5.94625C18.8925 2.66209 16.2304 0 12.9463 0C9.66209 0 7 2.66209 7 5.94625C7 9.23042 9.66209 11.8925 12.9463 11.8925C14.4191 11.8925 15.773 11.3528 16.8159 10.4563L17.0629 10.7124V11.4351L21.6369 16L23 14.6369L18.4351 10.0629ZM12.9463 10.0629C12.6763 10.0629 12.4124 10.0371 12.1571 9.98773C10.9662 9.75762 9.96023 9.01621 9.37566 8C9.03652 7.41043 8.83922 6.72837 8.82996 6C8.82973 5.98211 8.82962 5.9642 8.82962 5.94625C8.82962 5.24169 9.00554 4.57913 9.31596 4C9.82858 3.04364 10.708 2.3148 11.7677 2C12.0116 1.92753 12.2651 1.877 12.5259 1.85069C12.6641 1.83676 12.8043 1.82962 12.9463 1.82962C15.2241 1.82962 17.0629 3.66838 17.0629 5.94625C17.0629 8.22413 15.2241 10.0629 12.9463 10.0629Z" fill="#066BBB"/>
            <path d="M0 13C0 12.4477 0.447715 12 1 12H7C7.55228 12 8 12.4477 8 13C8 13.5523 7.55228 14 7 14H1C0.447715 14 0 13.5523 0 13Z" fill="#066BBB"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M1 4C0.447715 4 0 4.44772 0 5C0 5.55228 0.447715 6 1 6H8.82996C8.82973 5.98211 8.82962 5.9642 8.82962 5.94625C8.82962 5.24169 9.00554 4.57913 9.31596 4H1Z" fill="#066BBB"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M1 8C0.447715 8 0 8.44772 0 9C0 9.55228 0.447715 10 1 10H12C12.0535 10 12.1059 9.99581 12.1571 9.98773C10.9662 9.75762 9.96023 9.01621 9.37566 8H1Z" fill="#066BBB"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M1 0C0.447715 0 0 0.447715 0 1C0 1.55228 0.447715 2 1 2H11.7677C12.0116 1.92753 12.2651 1.877 12.5259 1.85069C12.8105 1.6744 13 1.35934 13 1C13 0.447715 12.5523 0 12 0H1Z" fill="#066BBB"/>
          </svg>
          Vocabulary
        </button>
      </div>

      <div class="mapping-footer__right">
        <div class="mapping-footer__block secondary">
          <button class="mapping-footer__delete-links grey-button red-color"
                  [disabled]="isMappingEmpty()"
                  (click)="deleteLinks()">Delete Links
          </button>

          <button class="mapping-footer__preview grey-button blue-color"
                  [disabled]="isMappingEmpty() || isSimilarTabs()"
                  (click)="previewMapping()">Preview
          </button>
        </div>

        <div class="mapping-footer__block general">
          <button class="mapping-footer__fake grey-button blue-color"
                  [disabled]="!hasScanReport"
                  (click)="generateFakeData()">Generate Fake
          </button>

          <button class="mapping-footer__report grey-button blue-color"
                  [disabled]="isMappingEmpty()"
                  (click)="generateReport()">Report
          </button>

          <button class="mapping-footer__cdm blue-button white-color"
                  [disabled]="isMappingEmpty()"
                  [matMenuTriggerFor]="cdmMenu">Convert to CDM
            <svg width="8" height="4" viewBox="0 0 8 4" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0 0L4 4L8 0H0Z" fill="white"/>
            </svg>
          </button>

          <mat-menu #cdmMenu="matMenu">
            <button mat-menu-item (click)="convertToCdm()">
              <mat-icon svgIcon="convert_data"></mat-icon>
              <span>Convert to CDM</span>
            </button>

            <button mat-menu-item (click)="generateMappingJson()">
              <mat-icon svgIcon="generate_and_save"></mat-icon>
              <span>Generate & Save Files</span>
            </button>
          </mat-menu>
        </div>
      </div>
    </footer>
  </section>
</div>

<app-vocabulary-search *ngIf="isVocabularyVisible" (close)="showVocabulary()"></app-vocabulary-search>
