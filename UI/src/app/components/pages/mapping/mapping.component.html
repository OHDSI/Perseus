<div class="app-mapping">
  <div class="export-actions">
    <button
      mat-icon-button
      matTooltip="Download ziped mappings"
      aria-label="generate mapping xmls"
      (click)="generateMappingJson()"
    >
      <mat-icon>file_download</mat-icon>
    </button>
    <button
      mat-icon-button
      matTooltip="Preview mappings"
      aria-label="preview mapping xmls"
      (click)="previewMapping()"
    >
      <mat-icon>play_circle_filled_white</mat-icon>
    </button>
    <button
      mat-icon-button
      matTooltip="Delete all mappings"
      aria-label="delete all mappings"
      (click)="wipeAllMappings()"
    >
      <mat-icon>delete</mat-icon>
    </button>
  </div>
  <section>
    <main #maincanvas class="main">
      <app-area area="source" class="area-source">
        <mat-tab-group (selectedIndexChange)="onTabIndexChanged($event, source, 'source')">
          <mat-tab
            [label]="table.name | prettyName"
            *ngFor="let table of source; trackBy: trackByFn"
          >
            <app-panel-source
              #sourcePanel
              *ngIf="table.visible"
              [tabIndex]="sourceTabIndex"
              [table]="table"
              [tables]="source"
              (open)="onPanelOpen(table)"
              (close)="onPanelClose(table)"
              (initialized)="onPanelInit(table)"
            ></app-panel-source>
          </mat-tab>
        </mat-tab-group>
      </app-area>
      <!--Bridge-->
      <div class="hint">
        <div class="patch-top"></div>
        <svg class="canvas" #arrowsarea>
          <defs>
            <marker
              id="marker-start"
              viewBox="0 0 20 20"
              refX="4"
              refY="8"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <rect x="0" y="0" rx="5" width="20" height="16" fill="#BDBDBD" pointer-events="visiblePoint"/>
              <line x1="8" y1="4" x2="16" y2="12" style="stroke:rgb(255, 255, 255); stroke-width: 1.5" />
              <line x1="16" y1="4" x2="8" y2="12" style="stroke:rgb(255, 255, 255); stroke-width: 1.5" />
            </marker>
            <marker
              id="marker-start-active"
              viewBox="0 0 20 20"
              refX="4"
              refY="8"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <rect x="0" y="0" rx="5" width="20" height="16" fill="#066BBB"/>
              <line x1="8" y1="4" x2="16" y2="12" style="stroke:rgb(255, 255, 255); stroke-width: 1.5" />
              <line x1="16" y1="4" x2="8" y2="12" style="stroke:rgb(255, 255, 255); stroke-width: 1.5" />
            </marker>

            <marker
              id="marker-end"
              viewBox="0 0 20 20"
              refX="10"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#BDBDBD" />
            </marker>
            <marker
              id="marker-end-T"
              viewBox="0 0 20 20"
              refX="10"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#BDBDBD" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11;">T</text>
            </marker>
            <marker
              id="marker-end-L"
              viewBox="0 0 20 20"
              refX="10"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#BDBDBD" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11;">L</text>
            </marker>
            <marker
              id="marker-end-active"
              viewBox="0 0 20 20"
              refX="10"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#066BBB" />
            </marker>
            <marker
              id="marker-end-active-T"
              viewBox="0 0 20 20"
              refX="10"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#066BBB" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11;">T</text>
            </marker>
            <marker
              id="marker-end-active-L"
              viewBox="0 0 20 20"
              refX="10"
              refY="10"
              markerWidth="20"
              markerHeight="20"
              markerUnits="userSpaceOnUse"
            >
              <circle cx="10" cy="10" r="8" fill="#066BBB" />
              <text x="7" y="14" style="fill:rgb(255, 255, 255); font-size: 11;">L</text>
            </marker>
          </defs>
        </svg>
        <!-- <div class="patch-bottom"></div> -->
      </div>
      <!--End-of-the-Bridge-->
      <app-area area="target" class="area-target">
        <mat-tab-group [selectedIndex]="targetTabIndex" (selectedIndexChange)="onTabIndexChanged($event, target, 'target')">
          <mat-tab
            [label]="table.name | prettyName"
            *ngFor="let table of target; trackBy: trackByFn"
            [disabled]="isDisabled(table.name)"
          >
            <app-panel-target
              #targetPanel
              *ngIf="table.visible"
              [tabIndex]="targetTabIndex"
              [table]="table"
              [tables]="target"
              (open)="onPanelOpen(table)"
              (close)="onPanelClose(table)"
              (initialized)="onPanelInit(table)"
            ></app-panel-target>
          </mat-tab>
        </mat-tab-group>
      </app-area>
    </main>
    <footer></footer>
  </section>
</div>
