<nav>
  <h3>Filter by columns</h3>
  <h4>Source columns
    <ng-container *ngIf="data.source?.length">({{sourceRows.length}})</ng-container>
  </h4>
  <app-comfy-search-by-name
    *ngIf="data.source?.length"
    class="filter-by-name"
    placeholder='Search by source column'
    (complete)="filterByName('source-column', $event)"
    (reset)="filterByNameReset('source-column', $event)"
  ></app-comfy-search-by-name>
  <app-columns-list
    *ngIf="data.source?.length"
    class="source-columns-list"
    [sourceRows]="sourceRows"
    (columnsSelected)="findTables($event)"
  ></app-columns-list>
</nav>
<main>
  <h3>Link tables</h3>
  <div class="articles">
    <article>
      <h4>Source tables
        <ng-container *ngIf="data.source?.length">({{data.source.length}})</ng-container>
      </h4>
      <app-comfy-search-by-name
        *ngIf="data.source?.length"
        class="filter-by-name"
        placeholder="Search by source table"
        (complete)="filterByName('source', $event)"
        (reset)="filterByNameReset('source', $event)"
      ></app-comfy-search-by-name>
      <a *ngIf="data.source?.length" (click)="openJoinTablesEditor()">Join tables</a>
      <div class="scrolled-items-rtl"
           *ngIf="data.source?.length">
        <div
          class="cdm-list"
          cdkDropList
          cdkDropListSortingDisabled
          #sourceList="cdkDropList"
          [cdkDropListData]="source"
          [cdkDropListConnectedTo]="sourceConnectedTo">
          <div class="cdm-box"
               highlight
               cdkDrag
               *ngFor="let item of source"
               [attr.criteria]="item"
               [values]="highlitedTables">
            <mat-icon>drag_indicator</mat-icon>
            <div
              class="table-description source caption"
              [matTooltip]="item"
              matTooltipPosition="right"
              [concept]="item">
              {{ item }}
            </div>
            <div *cdkDragPreview
                 class="table-description source preview">
              {{ item }}
            </div>
          </div>
        </div>
      </div>
      <div class="initial"
           *ngIf="!data.source.length">
        <p>Please load New Report to see Source tables</p>
        <input
          #sourceUpload
          type="file"
          (change)="onFileUpload($event)"
          hidden/>
        <button mat-flat-button
                color="accent"
                (click)="loadNewReport()">
          Load New Report
        </button>
      </div>
    </article>
    <article>
      <h4>Target tables
        <span *ngIf="data.target?.length">({{data.target.length}})</span>
        <label
          class="cdm-filter-label"
          *ngIf="data.filtered?.types.length"
          [matTooltip]="data.filtered.types"
          matTooltipPosition="above">
          {{data.filtered.types}}
        </label>
        <mat-icon *ngIf="data.target?.length"
                  matTooltip="Filters applied"
                  matTooltipPosition="above"
                  [matTooltipDisabled]="!data.filtered?.types.length"
                  [class]="{active: data.filtered?.types.length}"
                  (click)="openFilter($event.target)">sort
        </mat-icon>
      </h4>
      <app-comfy-search-by-name
        class="filter-by-name"
        placeholder="Search by target table"
        (complete)="filterByName('target', $event)"
        (reset)="filterByNameReset('target', $event)"
        *ngIf="data.target?.length"
      ></app-comfy-search-by-name>
      <div class="scrolled-items"
           #scrollEl
           cdk-scrollable
           *ngIf="data.target?.length">
        <div
          [id]="target[targetName].name"
          class="vertical-list"
          *ngFor="let targetName of targetTableNames"
          cdkDropList
          [cdkDropListData]="target[targetName].data"
          (cdkDropListDropped)="!drop.canExecute($event) || drop.execute($event)">
          <div
            class="vertical-box"
            *ngFor="let tableName of target[targetName].data; let i = index">
            <div
              class="table-description target caption"
              [matTooltip]="tableName"
              matTooltipPosition="right"
              (click)="openMapping(tableName)">
              <span class="target-label">{{ tableName }}</span>
              <span class="divider"></span>
              <mat-icon
                *ngIf="i > 0"
                class="remove-mapping-table"
                (click)="removeTableMapping($event, tableName, targetName)">close
              </mat-icon>
            </div>
          </div>
        </div>
      </div>
      <div class="initial"
           *ngIf="!data.target.length">
        <p>Please select CDM version to see Target tables</p>
        <button mat-flat-button
                color="accent"
                (click)="openSetCDMDialog()">
          Set CDM Version
        </button>
      </div>
    </article>
  </div>
</main>
