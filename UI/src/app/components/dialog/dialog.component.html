<mat-card class="dialog">
  <mat-list>
    <ng-container *ngFor='let comment of comments'>
      <ng-template [ngTemplateOutlet]='loadTemplate(comment)' [ngTemplateOutletContext]='{ $implicit: comment}'>
      </ng-template>
    </ng-container>
  </mat-list>
  <input [(ngModel)]='value' [disabled]='isDisabled()' placeholder='Input comment' class='input input-add'
    (keyup.enter)='add()'>
  <button mat-button (click)='add()' [disabled]='isDisabled()' disableRipple='true'>
    Add
  </button>
</mat-card>

<ng-template #readOnlyTemplate let-comment>
  <mat-list-item>
    <div class="read">
      <div class="head">
        <span class="date">
          {{comment.date | date:'MMM d'}}
          <ng-container *ngIf='comment.hasBeenEdited'>
            <span>(edited)</span>
          </ng-container>
        </span>
        <div>
          <button mat-icon-button disableRipple='true' (click)='edit(comment)'>
            <mat-icon>
              edit
            </mat-icon>
          </button>
          <button mat-icon-button disableRipple='true' (click)='delete(comment)'>
            <mat-icon>
              delete
            </mat-icon>
          </button>
        </div>
      </div>
      <div class="body">
        <p class="text">
          {{comment.text}}
        </p>
      </div>
    </div>
  </mat-list-item>
</ng-template>

<ng-template #editTemplate let-comment>
  <mat-list-item>
    <div class="edit">
      <div class="head">
        <span class="date">
          {{comment.date | date:'MMM d'}}
        </span>
        <div class="buttons">
          <button mat-icon-button disableRipple='true' (click)='delete(comment)'>
            <mat-icon>
              delete
            </mat-icon>
          </button>
        </div>
      </div>
      <div class="body">
        <input type='text' placeholder='Edit comment' [value]='comment.text' #input class="input input-edit"
          (keyup.enter)='applyChanges(comment, input.value)'>
        <div class="buttons">
          <button mat-icon-button disableRipple='true'>
            <mat-icon (click)='discardChanges()'>
              close
            </mat-icon>
          </button>
          <button mat-icon-button disableRipple='true'>
            <mat-icon (click)='applyChanges(comment, input.value)'>
              check
            </mat-icon>
          </button>
        </div>
      </div>
    </div>
  </mat-list-item>
</ng-template>